<!DOCTYPE html>
<html>
<head>
	<title>Quản lí nhân viên</title>
	<% include ../partials/head %>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		html, body{
			height: 100%
		}
	</style>
</head>
<body style="margin-right: 0 !important">	
	<%include ../partials/header%>
	<div style="min-height: 85%"> 
		<% include ../partials/anhchay %>
		<div class="container" style="margin-top: 20px; ">  
			<div class="row">
				<div class="form-group">
					<div class="col-sm-3">
						<a href="/danhSachNhanVien">
							<h4 style="color: red;"><b>Danh sách nhân viên</b></h4>
						</a>
					</div> 
				</div> 
				<form action="/search_nhanvien" method="get">
					<div class="form-group">
						<div class="col-sm-3 col-sm-offset-2">
							<input type="text" class="form-control" placeholder="Tìm kiếm tại đây..." name="noi_dung_tim_kiem">
						</div>
						<div class="col-sm-1">
							<div class="btn-group"> 
								<button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-search"></span>Tìm kiếm</button>
							</div> 
						</div>  
					</div>					
				</form>
				<div class="col-sm-2" style="text-align: right; margin-left: 82px;">
					<button type="button" class="btn btn-primary" style="text-align: right;">Thêm nhân viên</button>
				</div>
			</div>
			<hr>
			<table class="table table-hover">
				<thead>
					<tr>
						<th>STT</th>
						<th>Mã nhân viên</th>
						<th>Họ tên</th>
						<th>Địa chỉ</th>
						<th>Email</th>
						<th>Số điện thoại</th>
						<th>Hành động</th>
					</tr>
				</thead>
				<tbody>
					<%for (var i=0; i<danhSachNhanVien.length; i++){%>
						<tr>
							<td><%=i+1%></td>
							<td><%=danhSachNhanVien[i].MaNV%></td>
							<td><%=danhSachNhanVien[i].HoTen%></td>
							<td><%=danhSachNhanVien[i].DiaChi%></td>
							<td><%=danhSachNhanVien[i].Email%></td>
							<td><%=danhSachNhanVien[i].SoDienThoai%></td>
							<td>
								<%var HoTen = danhSachNhanVien[i].HoTen;%>
								<button type="button" class="btn btn-default" data-toggle="modal" data-target="#myModal" data-info='{"HoTen":"<%=danhSachNhanVien[i].HoTen%>", "DiaChi":"<%=danhSachNhanVien[i].DiaChi%>", "Email":"<%=danhSachNhanVien[i].Email%>", "SoDienThoai":"<%=danhSachNhanVien[i].SoDienThoai%>"}'>
									<span class="glyphicon glyphicon-wrench"></span>
								</button>
								<button class="btn btn-default">
								    <span class="glyphicon glyphicon-trash"></span>
								</button>												
							</td>		
										
						</tr>	
					<%};%>
				</tbody>
			</table>	
		</div>	

		
		<!-- Modal -->
	 	<div class="modal fade" id="myModal" role="dialog">
	    	<div class="modal-dialog modal-lg">
	    
		      	<!-- Noi dung cua modal -->
		      	<div class="modal-content">
			        <div class="modal-header">
				        <button type="button" class="close" data-dismiss="modal">&times;</button>
				        <h4 class="modal-title">Sửa thông tin nhân viên</h4>
			        </div>

			        <!-- Thong tin cua nhan vien -->
			        <div class="modal-body"> 
			        	<form >  
							<div class="form-group-inline">
		           				<label for="ma-nhan-vien">Tên nhân viên: </label>
		           				<div class="input-group">
		           					<span class="input-group-addon">
										<i class="glyphicon glyphicon-user"></i> 
									</span>
									<input type="text" class="form-control" required="" id="HoTen">
		           				</div>
		           			</div>   

		           			<div class="form-group-inline">
		           				<label for="ma-nhan-vien">Số điện thoại: </label>
		           				<div class="input-group">
		           					<span class="input-group-addon">
										<i class="glyphicon glyphicon-phone"></i> 
									</span>
									<input type="text" class="form-control" required id="SoDienThoai" id="sdt">
		           				</div>
		           			</div>  

		           			<div class="form-group-inline">
		           				<label for="ma-nhan-vien">Địa chỉ: </label>
		           				<div class="input-group">
		           					<span class="input-group-addon">
										<i class="glyphicon glyphicon-home"></i> 
									</span>
									<input type="text" class="form-control" required="" id="DiaChi">
		           				</div>
		           			</div>   

		           			<div class="form-group-inline">
		           				<label for="ma-nhan-vien">Email: </label>
		           				<div class="input-group">
		           					<span class="input-group-addon">
										<i class="glyphicon glyphicon-envelope"></i> 
									</span>
									<input type="text" class="form-control" required="" id="Email">
		           				</div>
		           			</div>   
			  
				      		<div class="modal-footer">  
					        	<button type="button" id="capnhat" class="btn btn-primary" style="width: 90px;" onclick="suaNV();">Cập nhật</button>
					        	<button type="button" class="btn btn-default" data-dismiss="modal" style="width: 90px;" id="huybo">Hủy bỏ</button> 
					        </div>
			    		</form> 
		 			</div>
		 		</div>
	 		</div>
		</div>

		<script type="text/javascript">
			// Execute something when the modal window is shown.
			$('#myModal').on('show.bs.modal', function (event) {
			  var button = $(event.relatedTarget); // Button that triggered the modal

			  var HoTen = button.data('info').HoTen;
			  var DiaChi = button.data('info').DiaChi;
			  var Email = button.data('info').Email;
			  var SoDienThoai = button.data('info').SoDienThoai;

			  var modal = $(this);
			  modal.find('input[id="HoTen"]').val(HoTen);
			  modal.find('input[id="DiaChi"]').val(DiaChi);
			  modal.find('input[id="Email"]').val(Email);
			  modal.find('input[id="SoDienThoai"]').val(SoDienThoai);

			});
		</script>

		<script type="text/javascript" language="javascript">  
		function suaNV() {    
			var valid = true; // Kiem tra thong tin trong form co hop le: true => hop le

			// pattern kiem tra email va so dien thoai 
			var patternSDT = /^[0-9]{10,}$/;
			var patternEmail= /[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$/;
			var sdt = document.getElementById("SoDienThoai").value;
			var email = document.getElementById("Email").value; 

			if (!patternSDT.test(sdt, "gi")) {
				alert("Số điện thoại có ít nhất 10 số.");
				valid = false;
			}

			if (!patternEmail.test(email)) {
				alert("Email không đúng định dạng.");
				valid = false;
			}
	 
			if (valid) {
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("POST", "/suaNhanVien", false); 
				xmlhttp.onreadystatechange = function() {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						console.log(xmlhttp.responseText);
						if (xmlhttp.responseText == "1") {
							alert("Sửa nhân viên thành công"); 
							document.getElementById("huybo").click(); // dong modal popup
							document.getElementById("HoTen").value = "";
							document.getElementById("SoDienThoai").value = "";
							document.getElementById("DiaChi").value = "";
							document.getElementById("Email").value = "";
						}
						else if (xmlhttp.responseText == "0") {
							alert("Error!");
						}
					}

				}
				xmlhttp.setRequestHeader('Content-type', 'application/json');
				var thongTinNV = JSON.stringify({"HoTen": document.getElementById("HoTen").value, "SoDienThoai": document.getElementById("SoDienThoai").value, "DiaChi": document.getElementById("DiaChi").value, "Email": document.getElementById("Email").value});

				xmlhttp.send(thongTinNV); 
			}
		}
		</script>
</body>
</html>
